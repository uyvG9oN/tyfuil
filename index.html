<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
    </head>
    <body>
<input type="text" id="username" placeholder="Enter your name">
<button onclick="submitData()">Submit</button>

<script>
const binId = "67f9fa0e8960c979a58370aa"; // Replace with your bin ID
const apiKey = "$2a$10$edUV5Pk.rkRzpUENvnJoKOi3s.oxzkoIRhkI.YRZ4cOwG/WeKPPme"; // Replace with your API key
const binUrl = `https://api.jsonbin.io/v3/b/${binId}`;

async function submitData() {
  const username = document.getElementById("username").value;
  if (!username) return alert("Please enter a name!");

  try {
    // Step 1: Get existing data from the bin
    const getResponse = await fetch(binUrl, {
      method: "GET",
      headers: {
        "X-Master-Key": apiKey
      }
    });

    const existingData = await getResponse.json();

    // Ensure existingData.record is an array (in case it returns an object)
    const currentArray = Array.isArray(existingData.record) ? existingData.record : [];

    // Step 2: Append new entry
    const newEntry = { username, timestamp: new Date().toISOString() };
    const updatedArray = [...currentArray, newEntry];

    // Step 3: PUT the updated array back into the bin
    const putResponse = await fetch(binUrl, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "X-Master-Key": apiKey
      },
      body: JSON.stringify({ record: updatedArray }) // We need to wrap the array in an object under `record`
    });

    const result = await putResponse.json();
    console.log("Updated bin:", result);
    alert("Submission saved!");
  } catch (err) {
    console.error("Error:", err);
    alert("Something went wrong. Check the console.");
  }
}
</script>
    </body>
</html>
